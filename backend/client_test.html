<head>
  <!--<script src="https://js.braintreegateway.com/v2/braintree.js"></script>-->
  <script src="/jquery-2.1.3.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/card.css">
  <script>
    function init() {
      ajaxCall("/charity/all/", "GET", function(result) {
        ajaxCall("/charity/45567/", "GET", function(result) {
          var json = $.parseJSON(result);
          $('.card-list').append('<div class="card-image"><div class="title">' + json.name
            + '</div><div class="content">' + json.description + '</div></div></div>');
        });
        //var arr = result.split(',');
//        for (var i = 0; i < arr.length; i++) {
//          ajaxCall("/charity/" + arr[i] + '/', "GET", function(result) {
//            var json = eval(result);
//            $('.card-list').children().append('<div class="card-image"><div class="title">' + json.name + '</div></div>');
//          });
//        }
      });
    }

    function chromeAjaxCall(url, type) {
      chrome.runtime.sendMessage({
        method: type,
        action: 'xhttp',
        contentType: 'application/json',
        url: url
        //data: 'q=something'
      }, function(result) {
        var json = eval(result);
        $('.card-list').append('<div class="card-image"><div class="title">' + json.name + '</div></div>');
      });
    }

    function ajaxCall(url, type, callback) {
      $.ajax({
        url: url,
        type: type,
        contentType: "application/json",
        success: callback,
        error: function(result) {
          console.log(result);
        }
      });
    }
  </script>
</head>

<body onload="init();">
  <form id="donations" method="post" action="/donations">
    <div class="card-list">
    </div>

    <!--<div id="dropin"></div>-->
    <!--<input type="submit" value="Pay $10">-->
  </form>

  <script> 
    //getAccountInfo();
    function getAccountInfo() {
      var req = new XMLHttpRequest();
      req.open("GET", 'account', true);
      req.onload = function(e) {
        if (req.readyState === 4) {
          if (req.status === 200) {
            setupPaymentDetails(req.responseText)
          } else {
            console.error(req.statusText);
          }
        }
      }
      req.send(null)
    };

    function setupPaymentDetails(properties) {
      var account_info = JSON.parse(properties);
      var client_token = account_info.client_token;
      console.log(client_token)
      braintree.setup(
        client_token,
        'dropin', {
          container: 'dropin'
      });
    }
  </script>
</body>
